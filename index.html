<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yolksters - Clean Recipe Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .egg-shell {
            position: absolute;
            width: 100px;
            height: 120px;
            left: 10px;
            top: 0;
        }
        
        .egg-shell-top {
            width: 100px;
            height: 60px;
            background: white;
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: 0;
            animation: crack 2s ease-in-out infinite;
        }
        
        @keyframes crack {
            0%, 90%, 100% { transform: rotate(0deg) translateY(0); }
            95% { transform: rotate(-5deg) translateY(-3px); }
        }
        
        .egg-shell-bottom {
            width: 100px;
            height: 60px;
            background: white;
            border-radius: 0 0 50% 50%;
            position: absolute;
            bottom: 0;
        }
        
        .yolk {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ffd93d 0%, #ffb93d 100%);
            border-radius: 50%;
            top: 25px;
            left: 25px;
            box-shadow: 0 5px 20px rgba(255, 185, 61, 0.4);
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .yolk-face {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .eye {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
            top: 25px;
        }
        
        .eye-left {
            left: 20px;
        }
        
        .eye-right {
            right: 20px;
        }
        
        .smile {
            position: absolute;
            width: 30px;
            height: 15px;
            border: 3px solid #333;
            border-top: none;
            border-radius: 0 0 30px 30px;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -1px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .user-info {
            text-align: center;
            color: white;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .plan-badge {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .plan-badge.pro {
            background: gold;
            color: #333;
            font-weight: 600;
        }
        
        .auth-section {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-section h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .auth-form input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .auth-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .auth-form button {
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .auth-form button:hover {
            background: #5568d3;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 15px;
            color: #667eea;
            cursor: pointer;
        }
        
        .auth-toggle:hover {
            text-decoration: underline;
        }
        
        .auth-error {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .tab.active {
            background: white;
            color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .usage-banner {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .usage-banner.limit-reached {
            background: #fee2e2;
            border-left-color: #ef4444;
        }
        
        .upgrade-btn-small {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .upgrade-btn-small:hover {
            background: #5568d3;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        input[type="url"], input[type="email"], input[type="password"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        
        .result-section.visible {
            display: block;
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .recipe-title-section {
            flex: 1;
            min-width: 250px;
        }
        
        .recipe-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .category-select {
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 14px;
            color: #667eea;
            background: white;
            cursor: pointer;
        }
        
        .recipe-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .save-btn {
            background: #48bb78;
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .save-btn:hover {
            background: #38a169;
        }
        
        .save-btn.saved {
            background: #e53e3e;
        }
        
        .scaling-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .scaling-controls label {
            font-weight: 600;
            color: #667eea;
        }
        
        .scale-btn {
            padding: 8px 16px;
            font-size: 14px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .scale-btn.active {
            background: #667eea;
            color: white;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .ingredients-list, .instructions-list {
            line-height: 1.8;
        }
        
        .ingredients-list li {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ingredients-list li:hover {
            background: #f7fafc;
        }
        
        .ingredients-list li.checked {
            text-decoration: line-through;
            opacity: 0.5;
        }
        
        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .checkbox.checked {
            background: #667eea;
        }
        
        .checkbox.checked:after {
            content: "✓";
            color: white;
            font-size: 14px;
        }
        
        .instructions-list {
            counter-reset: step-counter;
            list-style: none;
        }
        
        .instructions-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 40px;
            margin-bottom: 15px;
        }
        
        .instructions-list li:before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            background: #667eea;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 1.1em;
            margin-top: 15px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .print-btn {
            background: #4299e1;
        }
        
        .print-btn:hover {
            background: #3182ce;
        }
        
        .shopping-btn {
            background: #ed8936;
        }
        
        .shopping-btn:hover {
            background: #dd6b20;
        }
        
        .saved-recipes {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .category-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-filter {
            padding: 8px 16px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .category-filter:hover {
            border-color: #667eea;
        }
        
        .category-filter.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .saved-recipe-card {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .saved-recipe-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        
        .saved-recipe-info {
            flex: 1;
        }
        
        .saved-recipe-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .saved-recipe-category {
            display: inline-block;
            padding: 4px 10px;
            background: #e6f3ff;
            color: #667eea;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .delete-btn {
            background: #e53e3e;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .delete-btn:hover {
            background: #c53030;
        }
        
        .empty-state {
            text-align: center;
            color: #718096;
            padding: 60px 20px;
        }
        
        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .shopping-list {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .shopping-list h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .clear-list-btn {
            background: #e53e3e;
            margin-top: 20px;
        }
        
        .pricing-section {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .pricing-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .pricing-header h2 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .pricing-header p {
            font-size: 1.2em;
            color: #718096;
        }
        
        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .pricing-card {
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            transition: all 0.3s;
        }
        
        .pricing-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
        }
        
        .pricing-card.featured {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #e6f3ff 100%);
            position: relative;
        }
        
        .pricing-card.featured:before {
            content: "MOST POPULAR";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #667eea;
            color: white;
            padding: 6px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .plan-name {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .plan-price {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .plan-price span {
            font-size: 0.4em;
            color: #718096;
            font-weight: 400;
        }
        
        .plan-features {
            list-style: none;
            margin: 25px 0;
        }
        
        .plan-features li {
            padding: 10px 0;
            display: flex;
            align-items: start;
            gap: 10px;
            font-size: 0.95em;
        }
        
        .plan-features li:before {
            content: "✓";
            color: #48bb78;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .plan-features li.unavailable {
            opacity: 0.4;
        }
        
        .plan-features li.unavailable:before {
            content: "✗";
            color: #cbd5e0;
        }
        
        .select-plan-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .select-plan-btn.primary {
            background: #667eea;
            color: white;
        }
        
        .select-plan-btn.primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .select-plan-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .select-plan-btn.secondary:hover {
            background: #f7fafc;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.visible {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .modal h3 {
            font-size: 2em;
            margin-bottom: 15px;
            color: #333;
        }
        
        .modal p {
            font-size: 1.1em;
            color: #718096;
            margin-bottom: 30px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .close-modal-btn {
            background: #cbd5e0;
            color: #333;
        }
        
        .close-modal-btn:hover {
            background: #a0aec0;
        }
        
        @media print {
            body {
                background: white;
            }
            .header, .tabs, .input-section, .action-buttons, .scaling-controls, .save-btn {
                display: none;
            }
            .result-section {
                box-shadow: none;
            }
        }
    .cooking-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .cooking-mode.active {
            display: flex;
        }
        
        .cooking-header {
            background: #667eea;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .cooking-title {
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .exit-cooking {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .exit-cooking:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .cooking-ingredients {
            background: #f7fafc;
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .cooking-ingredients h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .cooking-ingredients-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .cooking-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }
        
        .step-progress {
            font-size: 1.2em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 30px;
        }
        
        .step-instruction {
            font-size: 2em;
            line-height: 1.6;
            text-align: center;
            color: #333;
            margin-bottom: 40px;
            max-width: 700px;
        }
        
        .cooking-nav {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .cooking-btn {
            padding: 20px 40px;
            font-size: 1.3em;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .prev-btn {
            background: #e2e8f0;
            color: #333;
        }
        
        .prev-btn:hover:not(:disabled) {
            background: #cbd5e0;
        }
        
        .next-btn {
            background: #667eea;
            color: white;
        }
        
        .next-btn:hover:not(:disabled) {
            background: #5568d3;
        }
        
        .cooking-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .step-instruction {
                font-size: 1.5em;
            }
            
            .cooking-btn {
                padding: 15px 30px;
                font-size: 1.1em;
                min-width: 120px;
            }
        }    
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="egg-shell">
                    <div class="egg-shell-top"></div>
                    <div class="egg-shell-bottom"></div>
                </div>
                <div class="yolk">
                    <div class="yolk-face">
                        <div class="eye eye-left"></div>
                        <div class="eye eye-right"></div>
                        <div class="smile"></div>
                    </div>
                </div>
            </div>
            <h1>Yolksters</h1>
            <p>Crack open clean recipes • No ads, no stories, just cooking</p>
            <div class="user-info" id="userInfo"></div>
            <div class="plan-badge" id="planBadge">Free Plan</div>
        </div>
        
        <div id="authContainer"></div>
        <div id="appContainer" style="display: none;">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('clean')">Clean Recipe</button>
                <button class="tab" onclick="switchTab('saved')">Saved (<span id="savedCount">0</span>)</button>
                <button class="tab" onclick="switchTab('shopping')">Shopping (<span id="shoppingCount">0</span>)</button>
                <button class="tab" onclick="switchTab('pricing')">Upgrade</button>
            </div>
            
            <div id="cleanTab" class="tab-content active">
                <div class="input-section">
                    <div id="usageBanner" class="usage-banner">
                        <div>
                            <strong>Free Plan:</strong> <span id="usageText">3 recipes this month (0/3 used)</span>
                        </div>
                        <button class="upgrade-btn-small" onclick="switchTab('pricing'); document.querySelectorAll('.tab')[3].click();">Upgrade</button>
                    </div>
                    
                    <div class="input-group">
                        <input type="url" id="recipeUrl" placeholder="Paste recipe URL here..." />
                        <button onclick="cleanRecipe()">Clean Recipe</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; color: #718096;">
                        <strong>OR</strong>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="loadDemoRecipe()" style="background: #48bb78;">Try Demo Recipe</button>
                    </div>
                    
                    <div id="loading" class="loading" style="display: none;">Fetching recipe...</div>
                    <div id="error" class="error" style="display: none;"></div>
                </div>
                
                <div id="result" class="result-section">
                    <div class="recipe-header">
                        <div class="recipe-title-section">
                            <h2 id="recipeTitle" class="recipe-title"></h2>
                            <select id="categorySelect" class="category-select">
                                <option value="">Select Category</option>
                                <option value="Breakfast">Breakfast</option>
                                <option value="Lunch">Lunch</option>
                                <option value="Dinner">Dinner</option>
                                <option value="Dessert">Dessert</option>
                                <option value="Snacks">Snacks</option>
                                <option value="Drinks">Drinks</option>
                                <option value="Baking">Baking</option>
                                <option value="Vegetarian">Vegetarian</option>
                                <option value="Quick Meals">Quick Meals</option>
                            </select>
                        </div>
                        <div class="recipe-actions">
                            <button id="saveBtn" class="save-btn" onclick="toggleSaveRecipe()">Save Recipe</button>
                        </div>
                    </div>
                    
                    <div class="scaling-controls">
                        <label>Servings:</label>
                        <button class="scale-btn" onclick="scaleRecipe(0.5)">½x</button>
                        <button class="scale-btn active" onclick="scaleRecipe(1)">1x</button>
                        <button class="scale-btn" onclick="scaleRecipe(2)">2x</button>
                        <button class="scale-btn" onclick="scaleRecipe(3)">3x</button>
                    </div>
                    
                    <div id="ingredientsSection">
                        <h3 class="section-title">Ingredients (click to check off)</h3>
                        <ul id="ingredients" class="ingredients-list"></ul>
                    </div>
                    
                    <div id="instructionsSection">
                        <h3 class="section-title">Instructions</h3>
                        <ol id="instructions" class="instructions-list"></ol>
                    </div>
                    
                    <div class="action-buttons">
    <button class="print-btn" onclick="window.print()">Print Recipe</button>
    <button class="shopping-btn" onclick="addToShoppingList()">Add to Shopping List</button>
    <button onclick="startCookingMode()" style="background: #48bb78;">Start Cooking Mode</button>
</div>
                </div>
            </div>
            
            <div id="savedTab" class="tab-content">
                <div class="saved-recipes">
                    <h2 style="color: #667eea; margin-bottom: 20px;">Your Saved Recipes</h2>
                   <div style="margin-bottom: 20px;">
                        <input 
                            type="text" 
                            id="recipeSearch" 
                            placeholder="Search recipes by name or ingredient..." 
                            style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;"
                            oninput="filterSavedRecipes()"
                        />
                    </div> 
                    <div class="category-filters">
                        <button class="category-filter active" onclick="filterByCategory('all')">All</button>
                        <button class="category-filter" onclick="filterByCategory('Breakfast')">Breakfast</button>
                        <button class="category-filter" onclick="filterByCategory('Lunch')">Lunch</button>
                        <button class="category-filter" onclick="filterByCategory('Dinner')">Dinner</button>
                        <button class="category-filter" onclick="filterByCategory('Dessert')">Dessert</button>
                        <button class="category-filter" onclick="filterByCategory('Snacks')">Snacks</button>
                    </div>
                    
                    <div id="savedRecipesList"></div>
                </div>
            </div>
            
            <div id="shoppingTab" class="tab-content">
                <div class="shopping-list">
                    <h2>Shopping List</h2>
                    <ul id="shoppingListItems" class="ingredients-list"></ul>
                    <button class="clear-list-btn" onclick="clearShoppingList()">Clear List</button>
                </div>
            </div>
            
            <div id="pricingTab" class="tab-content">
                <div class="pricing-section">
                    <div class="pricing-header">
                        <h2>Choose Your Plan</h2>
                        <p>Unlimited clean recipes, no more life stories</p>
                    </div>
                    
                    <div class="pricing-cards">
                        <div class="pricing-card">
                            <div class="plan-name">Free</div>
                            <div class="plan-price">$0<span>/forever</span></div>
                            <ul class="plan-features">
                                <li>3 recipes per month</li>
                                <li class="unavailable">Unlimited recipes</li>
                                <li class="unavailable">Save favorites</li>
                                <li class="unavailable">Shopping lists</li>
                                <li class="unavailable">Recipe scaling</li>
                                <li class="unavailable">Category organization</li>
                            </ul>
                            <button class="select-plan-btn secondary" onclick="selectPlan('free')">Current Plan</button>
                        </div>
                        
                        <div class="pricing-card featured">
                            <div class="plan-name">Yolksters Pro</div>
                            <div class="plan-price">$4.99<span>/month</span></div>
                            <ul class="plan-features">
                                <li>Unlimited recipes</li>
                                <li>Save unlimited favorites</li>
                                <li>Shopping list generator</li>
                                <li>Recipe scaling (½x to 3x)</li>
                                <li>Category organization</li>
                                <li>Priority support</li>
                            </ul>
                            <button class="select-plan-btn primary" onclick="selectPlan('pro-monthly')">Upgrade Now</button>
                        </div>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="cookingMode" class="cooking-mode">
        <div class="cooking-header">
            <div class="cooking-title" id="cookingRecipeTitle"></div>
            <button class="exit-cooking" onclick="exitCookingMode()">Exit Cooking Mode</button>
        </div>
        
        <div class="cooking-ingredients">
            <h3>Ingredients</h3>
            <div class="cooking-ingredients-list" id="cookingIngredientsList"></div>
        </div>
        
        <div class="cooking-content">
            <div class="step-progress" id="stepProgress"></div>
            <div class="step-instruction" id="stepInstruction"></div>
            <div class="cooking-nav">
                <button class="cooking-btn prev-btn" id="prevStepBtn" onclick="previousStep()">← Previous</button>
                <button class="cooking-btn next-btn" id="nextStepBtn" onclick="nextStep()">Next →</button>
            </div>
        </div>
    </div>
    <div id="upgradeModal" class="modal-overlay">
        <div class="modal">
            <h3>Upgrade to Pro</h3>
            <p id="modalMessage">This feature requires a Pro subscription</p>
            <div class="modal-buttons">
                <button class="close-modal-btn" onclick="closeModal()">Maybe Later</button>
                <button class="select-plan-btn primary" onclick="closeModal(); switchTab('pricing'); document.querySelectorAll('.tab')[3].click();">View Plans</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'https://api.yolksters.com';
        const SUPABASE_URL = 'https://kxtjtvrzczyrthkbrpuw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4dGp0dnJ6Y3p5cnRoa2JycHV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2Mjk4NjgsImV4cCI6MjA3NTIwNTg2OH0.SxiJknbV3stGo2v7m6PCpRG6W9QaFAjUNozdbosda-s';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let currentRecipe = null;
        let savedRecipes = [];
        let shoppingList = [];
        let currentScale = 1;
        let isPro = false;
        let recipesCleanedThisMonth = 0;
        let currentCategoryFilter = 'all';
        const FREE_RECIPE_LIMIT = 3;
        
        async function initAuth() {
    // Check if user is resetting password FIRST
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    if (hashParams.get('type') === 'recovery') {
        showNewPasswordForm();
        return; // Stop here
    }
    
    const { data: { session } } = await supabase.auth.getSession();
    
    if (session) {
        currentUser = session.user;
        await checkUserStatus();
        showApp();
    } else {
        showAuthForm();
    }
    
    checkPaymentStatus();
}
        
        function showAuthForm(mode = 'login') {
            const authContainer = document.getElementById('authContainer');
            const isLogin = mode === 'login';
            
            authContainer.innerHTML = `
                <div class="auth-section">
                    <h2>${isLogin ? 'Welcome Back' : 'Create Account'}</h2>
                    <form class="auth-form" onsubmit="handleAuth(event, '${mode}')">
                        <input type="email" id="authEmail" placeholder="Email" required />
                        <input type="password" id="authPassword" placeholder="Password" required />
                        <div id="authError" class="auth-error" style="display: none;"></div>
                        <button type="submit">${isLogin ? 'Log In' : 'Sign Up'}</button>
                    </form>
                    <div class="auth-toggle" onclick="showAuthForm('${isLogin ? 'signup' : 'login'}')">
    ${isLogin ? 'Need an account? Sign up' : 'Already have an account? Log in'}
</div>
${isLogin ? '<div class="auth-toggle" onclick="showPasswordReset()" style="margin-top: 10px;">Forgot password?</div>' : ''}
                </div>
            `;
            
            document.getElementById('appContainer').style.display = 'none';
        }
        
        async function handleAuth(event, mode) {
            event.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const errorDiv = document.getElementById('authError');
            
            errorDiv.style.display = 'none';
            
            try {
                let result;
                if (mode === 'login') {
                    result = await supabase.auth.signInWithPassword({ email, password });
                } else {
                    result = await supabase.auth.signUp({ email, password });
                }
                
                if (result.error) throw result.error;
                
                if (mode === 'signup') {
                    alert('Account created successfully. Please log in.');
                    showAuthForm('login');
                } else {
                    currentUser = result.data.user;
                    await checkUserStatus();
                    showApp();
                }
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }
        
        async function logout() {
    await supabase.auth.signOut();
    currentUser = null;
    isPro = false;
    savedRecipes = [];
    shoppingList = [];
    currentRecipe = null;
    
    // Clear the UI
    document.getElementById('userInfo').innerHTML = '';
    document.getElementById('planBadge').textContent = 'Free Plan';
    document.getElementById('planBadge').classList.remove('pro');
    document.getElementById('result').classList.remove('visible');
    
    showAuthForm();
}
function showPasswordReset() {
            const authContainer = document.getElementById('authContainer');
            
            authContainer.innerHTML = `
                <div class="auth-section">
                    <h2>Reset Password</h2>
                    <p style="color: #718096; margin-bottom: 20px;">Enter your email and we'll send you a password reset link.</p>
                    <form class="auth-form" onsubmit="handlePasswordReset(event)">
                        <input type="email" id="resetEmail" placeholder="Email" required />
                        <div id="resetError" class="auth-error" style="display: none;"></div>
                        <div id="resetSuccess" style="display: none; background: #d4edda; color: #155724; padding: 10px; border-radius: 6px; font-size: 14px; text-align: center; margin-bottom: 15px;"></div>
                        <button type="submit">Send Reset Link</button>
                    </form>
                    <div class="auth-toggle" onclick="showAuthForm('login')">
                        Back to login
                    </div>
                </div>
            `;
            
            document.getElementById('appContainer').style.display = 'none';
        }
        
        async function handlePasswordReset(event) {
            event.preventDefault();
            
            const email = document.getElementById('resetEmail').value;
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: 'https://yolksters.com',
                });
                
                if (error) throw error;
                
                successDiv.textContent = 'Password reset email sent! Check your inbox.';
                successDiv.style.display = 'block';
                
                setTimeout(() => {
                    showAuthForm('login');
                }, 3000);
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }
        function showNewPasswordForm() {
            const authContainer = document.getElementById('authContainer');
            
            authContainer.innerHTML = `
                <div class="auth-section">
                    <h2>Set New Password</h2>
                    <p style="color: #718096; margin-bottom: 20px;">Enter your new password below.</p>
                    <form class="auth-form" onsubmit="handleNewPassword(event)">
                        <input type="password" id="newPassword" placeholder="New Password (min 6 characters)" required minlength="6" />
                        <input type="password" id="confirmPassword" placeholder="Confirm New Password" required minlength="6" />
                        <div id="newPasswordError" class="auth-error" style="display: none;"></div>
                        <button type="submit">Update Password</button>
                    </form>
                </div>
            `;
            
            document.getElementById('appContainer').style.display = 'none';
        }
        
        async function handleNewPassword(event) {
            event.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('newPasswordError');
            
            errorDiv.style.display = 'none';
            
            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.style.display = 'block';
                return;
            }
            
            try {
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });
                
                if (error) throw error;
                
                alert('Password updated successfully! Please log in with your new password.');
                window.location.href = 'https://yolksters.com';
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }        
        async function checkUserStatus() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${API_URL}/api/user-status`, {
                    headers: {
                        'x-user-id': currentUser.id
                    }
                });
                
                const data = await response.json();
                isPro = data.status === 'pro';
                updatePlanUI();
            } catch (error) {
                console.error('Error checking user status:', error);
            }
        }
        
        async function showApp() {
    document.getElementById('authContainer').innerHTML = '';
    document.getElementById('appContainer').style.display = 'block';
    
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = `
        ${currentUser.email}
        <button class="logout-btn" onclick="logout()">Log Out</button>
    `;
    
    updatePlanUI();
    await loadSavedRecipes();
    await loadShoppingList();
}
        
        function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'true') {
                setTimeout(async () => {
                    await checkUserStatus();
                    if (isPro) {
                        alert('Welcome to Yolksters Pro. Your account has been upgraded.');
                    }
                    window.history.replaceState({}, document.title, window.location.pathname);
                }, 2000);
            }
        }
        
        function updatePlanUI() {
            const badge = document.getElementById('planBadge');
            const usageBanner = document.getElementById('usageBanner');
            
            if (isPro) {
                badge.textContent = 'Pro Plan';
                badge.classList.add('pro');
                usageBanner.style.display = 'none';
            } else {
                badge.textContent = 'Free Plan';
                badge.classList.remove('pro');
                updateUsageBanner();
            }
        }
        
        function updateUsageBanner() {
            const usageText = document.getElementById('usageText');
            const usageBanner = document.getElementById('usageBanner');
            const remaining = FREE_RECIPE_LIMIT - recipesCleanedThisMonth;
            
            if (remaining <= 0) {
                usageBanner.classList.add('limit-reached');
                usageText.innerHTML = `<strong>Limit reached.</strong> You've used all 3 free recipes this month.`;
            } else {
                usageBanner.classList.remove('limit-reached');
                usageText.textContent = `${remaining} recipes remaining this month (${recipesCleanedThisMonth}/${FREE_RECIPE_LIMIT} used)`;
            }
        }
        
        function showUpgradeModal(feature) {
            const modal = document.getElementById('upgradeModal');
            const message = document.getElementById('modalMessage');
            
            const messages = {
                'save': 'Saving recipes requires Yolksters Pro.',
                'shopping': 'Shopping lists require Yolksters Pro.',
                'scaling': 'Recipe scaling requires Yolksters Pro.',
                'limit': `You've reached your free limit of ${FREE_RECIPE_LIMIT} recipes this month.`
            };
            
            message.textContent = messages[feature] || 'This feature requires a Pro subscription';
            modal.classList.add('visible');
        }
        
        function closeModal() {
            document.getElementById('upgradeModal').classList.remove('visible');
        }
        
        async function selectPlan(plan) {
            if (plan === 'free') {
                alert('You are currently on the Free plan');
            } else if (plan === 'pro-monthly') {
                if (!currentUser) {
                    alert('Please log in to upgrade');
                    return;
                }
                
                try {
                    const response = await fetch(`${API_URL}/api/create-checkout`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            userId: currentUser.id,
                            email: currentUser.email
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.url) {
                        window.location.href = data.url;
                    } else {
                        alert('Failed to create checkout session.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to start checkout.');
                }
            } else if (plan === 'extension') {
                alert('Browser extension coming soon.');
            }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'saved') {
                displaySavedRecipes();
            } else if (tab === 'shopping') {
                displayShoppingList();
            }
        }
        
        function loadDemoRecipe() {
            const demoRecipe = {
                name: "Grandma's Secret Chocolate Chip Cookies",
                url: "demo",
                category: "Dessert",
                ingredients: [
                    "2 1/4 cups all-purpose flour",
                    "1 teaspoon baking soda",
                    "1 teaspoon salt",
                    "1 cup (2 sticks) butter, softened",
                    "3/4 cup granulated sugar",
                    "3/4 cup packed brown sugar",
                    "2 large eggs",
                    "2 teaspoons vanilla extract",
                    "2 cups chocolate chips"
                ],
                instructions: [
                    "Preheat your oven to 375°F (190°C).",
                    "In a small bowl, combine flour, baking soda, and salt. Set aside.",
                    "In a large bowl, beat the softened butter, granulated sugar, and brown sugar until creamy.",
                    "Add eggs and vanilla extract to the butter mixture and beat well.",
                    "Gradually blend in the flour mixture until just combined.",
                    "Stir in the chocolate chips by hand.",
                    "Drop rounded tablespoons of dough onto ungreased cookie sheets, spacing them about 2 inches apart.",
                    "Bake for 9 to 11 minutes or until golden brown.",
                    "Cool on baking sheets for 2 minutes, then remove to wire racks to cool completely."
                ],
                originalIngredients: [
                    "2 1/4 cups all-purpose flour",
                    "1 teaspoon baking soda",
                    "1 teaspoon salt",
                    "1 cup (2 sticks) butter, softened",
                    "3/4 cup granulated sugar",
                    "3/4 cup packed brown sugar",
                    "2 large eggs",
                    "2 teaspoons vanilla extract",
                    "2 cups chocolate chips"
                ]
            };
            
            currentRecipe = demoRecipe;
            currentScale = 1;
            
            if (!isPro) {
                recipesCleanedThisMonth++;
                updateUsageBanner();
            }
            
            displayRecipe(demoRecipe);
            updateSaveButton();
            document.getElementById('result').classList.add('visible');
        }
        
        async function cleanRecipe() {
            if (!isPro && recipesCleanedThisMonth >= FREE_RECIPE_LIMIT) {
                showUpgradeModal('limit');
                return;
            }
            
            const urlInput = document.getElementById('recipeUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a recipe URL');
                return;
            }
            
            document.getElementById('error').style.display = 'none';
            document.getElementById('result').classList.remove('visible');
            document.getElementById('loading').style.display = 'block';
            
            try {
                const response = await fetch(`${API_URL}/api/recipe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                if (!response.ok || !data.success) {
                    throw new Error(data.message || 'Failed to fetch recipe');
                }
                
                const recipe = data.recipe;
                
                currentRecipe = {
                    name: recipe.name,
                    ingredients: recipe.ingredients,
                    instructions: recipe.instructions,
                    originalIngredients: [...recipe.ingredients],
                    url: url,
                    category: ''
                };
                
                currentScale = 1;
                
                if (!isPro) {
                    recipesCleanedThisMonth++;
                    updateUsageBanner();
                }
                
                displayRecipe(currentRecipe);
                updateSaveButton();
                
            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'Failed to fetch recipe.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function scaleRecipe(scale) {
            if (!isPro) {
                showUpgradeModal('scaling');
                return;
            }
            
            currentScale = scale;
            
            document.querySelectorAll('.scale-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const scaledIngredients = currentRecipe.originalIngredients.map(ingredient => {
                return scaleIngredient(ingredient, scale);
            });
            
            currentRecipe.ingredients = scaledIngredients;
            displayIngredients(scaledIngredients);
        }
        
        function scaleIngredient(ingredient, scale) {
            if (scale === 1) return ingredient;
            
            return ingredient.replace(/(\d+\.?\d*|\d*\.?\d+)/g, (match) => {
                const num = parseFloat(match);
                const scaled = num * scale;
                return scaled % 1 === 0 ? scaled.toString() : scaled.toFixed(2);
            });
        }
        
        function displayRecipe(recipe) {
            document.getElementById('recipeTitle').textContent = recipe.name || 'Recipe';
            document.getElementById('categorySelect').value = recipe.category || '';
            displayIngredients(recipe.ingredients);
            
            const instructionsList = document.getElementById('instructions');
            instructionsList.innerHTML = '';
            recipe.instructions.forEach(instruction => {
                const li = document.createElement('li');
                li.textContent = instruction;
                instructionsList.appendChild(li);
            });
            
            document.getElementById('result').classList.add('visible');
        }
        
        function displayIngredients(ingredients) {
            const ingredientsList = document.getElementById('ingredients');
            ingredientsList.innerHTML = '';
            ingredients.forEach((ingredient, index) => {
                const li = document.createElement('li');
                li.onclick = () => toggleIngredientCheck(index);
                
                const checkbox = document.createElement('div');
                checkbox.className = 'checkbox';
                
                const text = document.createElement('span');
                text.textContent = ingredient;
                
                li.appendChild(checkbox);
                li.appendChild(text);
                ingredientsList.appendChild(li);
            });
        }
        
        function toggleIngredientCheck(index) {
            const items = document.querySelectorAll('#ingredients li');
            const item = items[index];
            const checkbox = item.querySelector('.checkbox');
            
            item.classList.toggle('checked');
            checkbox.classList.toggle('checked');
        }
        
        async function toggleSaveRecipe() {
    if (!isPro) {
        showUpgradeModal('save');
        return;
    }
    
    const category = document.getElementById('categorySelect').value;
    currentRecipe.category = category;
    
    const index = savedRecipes.findIndex(r => r.name === currentRecipe.name);
    
    if (index >= 0) {
        // Delete from database
        const recipeToDelete = savedRecipes[index];
        if (recipeToDelete.id) {
            await supabase
                .from('saved_recipes')
                .delete()
                .eq('id', recipeToDelete.id);
        }
        savedRecipes.splice(index, 1);
    } else {
        // Save to database
        const { data, error } = await supabase
            .from('saved_recipes')
            .insert({
                user_id: currentUser.id,
                name: currentRecipe.name,
                url: currentRecipe.url || '',
                category: currentRecipe.category || '',
                ingredients: currentRecipe.ingredients,
                instructions: currentRecipe.instructions,
                original_ingredients: currentRecipe.originalIngredients
            })
            .select()
            .single();
        
        if (!error && data) {
            savedRecipes.push({...currentRecipe, id: data.id});
        }
    }
    
    updateSaveButton();
    updateSavedCount();
}
        
        function updateSaveButton() {
            const saveBtn = document.getElementById('saveBtn');
            const isSaved = savedRecipes.some(r => r.name === currentRecipe.name);
            
            if (isSaved) {
                saveBtn.textContent = 'Unsave Recipe';
                saveBtn.classList.add('saved');
            } else {
                saveBtn.textContent = 'Save Recipe';
                saveBtn.classList.remove('saved');
            }
        }
        
        function updateSavedCount() {
            document.getElementById('savedCount').textContent = savedRecipes.length;
        }
        
        function filterByCategory(category) {
            currentCategoryFilter = category;
            
            document.querySelectorAll('.category-filter').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            displaySavedRecipes();
        }
        
         function displaySavedRecipes() {
            const list = document.getElementById('savedRecipesList');
            const searchTerm = document.getElementById('recipeSearch')?.value.toLowerCase() || '';
            
            // Filter by category
            let filtered = currentCategoryFilter === 'all' 
                ? savedRecipes 
                : savedRecipes.filter(r => r.category === currentCategoryFilter);
            
            // Filter by search term (name or ingredients)
            if (searchTerm) {
                filtered = filtered.filter(recipe => {
                    const nameMatch = recipe.name.toLowerCase().includes(searchTerm);
                    const ingredientMatch = recipe.ingredients.some(ing => 
                        ing.toLowerCase().includes(searchTerm)
                    );
                    return nameMatch || ingredientMatch;
                });
            }
            
            if (filtered.length === 0) {
                const message = searchTerm 
                    ? `No recipes found matching "${searchTerm}"`
                    : currentCategoryFilter === 'all' 
                        ? 'No saved recipes yet. Clean a recipe and click "Save Recipe" to add it here.'
                        : `No recipes in the ${currentCategoryFilter} category.`;
                list.innerHTML = `<div class="empty-state"><h3>No recipes found</h3><p>${message}</p></div>`;
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach((recipe) => {
                const actualIndex = savedRecipes.indexOf(recipe);
                const card = document.createElement('div');
                card.className = 'saved-recipe-card';
                
                const info = document.createElement('div');
                info.className = 'saved-recipe-info';
                info.onclick = () => loadSavedRecipe(actualIndex);
                
                const title = document.createElement('div');
                title.className = 'saved-recipe-title';
                title.textContent = recipe.name;
                
                info.appendChild(title);
                
                if (recipe.category) {
                    const category = document.createElement('span');
                    category.className = 'saved-recipe-category';
                    category.textContent = recipe.category;
                    info.appendChild(category);
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteSavedRecipe(actualIndex);
                };
                
                card.appendChild(info);
                card.appendChild(deleteBtn);
                list.appendChild(card);
            });
        }
     function filterSavedRecipes() {
            displaySavedRecipes();
        }   
        function loadSavedRecipe(index) {
            currentRecipe = savedRecipes[index];
            currentScale = 1;
            displayRecipe(currentRecipe);
            updateSaveButton();
            switchTab('clean');
            document.querySelector('.tab').click();
        }
        
        async function deleteSavedRecipe(index) {
    const recipe = savedRecipes[index];
    
    if (recipe.id) {
        await supabase
            .from('saved_recipes')
            .delete()
            .eq('id', recipe.id);
    }
    
    savedRecipes.splice(index, 1);
    displaySavedRecipes();
    updateSavedCount();
}
        
        async function addToShoppingList() {
    if (!isPro) {
        showUpgradeModal('shopping');
        return;
    }
    
    if (!currentRecipe) return;
    
    for (const ingredient of currentRecipe.ingredients) {
        if (!shoppingList.some(item => item.item === ingredient)) {
            const { data, error } = await supabase
                .from('shopping_list_items')
                .insert({
                    user_id: currentUser.id,
                    item: ingredient,
                    checked: false
                })
                .select()
                .single();
            
            if (!error && data) {
                shoppingList.push(data);
            }
        }
    }
    
    updateShoppingCount();
    alert('Ingredients added to shopping list');
}
        
        function displayShoppingList() {
            const list = document.getElementById('shoppingListItems');
            
            if (shoppingList.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>Shopping list is empty</h3><p>Add ingredients from a recipe to build your list</p></div>';
                return;
            }
            
            list.innerHTML = '';
            shoppingList.forEach((item, index) => {
                const li = document.createElement('li');
                li.onclick = () => toggleShoppingItem(index);
                
                const checkbox = document.createElement('div');
                checkbox.className = 'checkbox';
                
                const text = document.createElement('span');
                text.textContent = item;
                
                li.appendChild(checkbox);
                li.appendChild(text);
                list.appendChild(li);
            });
        }
        
        function toggleShoppingItem(index) {
            const items = document.querySelectorAll('#shoppingListItems li');
            const item = items[index];
            const checkbox = item.querySelector('.checkbox');
            
            item.classList.toggle('checked');
            checkbox.classList.toggle('checked');
        }
        
        async function clearShoppingList() {
    if (confirm('Clear all items from shopping list?')) {
        await supabase
            .from('shopping_list_items')
            .delete()
            .eq('user_id', currentUser.id);
        
        shoppingList = [];
        displayShoppingList();
        updateShoppingCount();
    }
}
        
        function updateShoppingCount() {
            document.getElementById('shoppingCount').textContent = shoppingList.length;
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        document.getElementById('recipeUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                cleanRecipe();
            }
        });
        
        initAuth();
    let currentStep = 0;
        
        function startCookingMode() {
            if (!currentRecipe || !currentRecipe.instructions || currentRecipe.instructions.length === 0) {
                alert('No recipe loaded');
                return;
            }
            
            currentStep = 0;
            
            document.getElementById('cookingRecipeTitle').textContent = currentRecipe.name;
            
            const ingredientsList = document.getElementById('cookingIngredientsList');
            ingredientsList.innerHTML = '';
            currentRecipe.ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.textContent = '• ' + ingredient;
                ingredientsList.appendChild(div);
            });
            
            updateCookingStep();
            document.getElementById('cookingMode').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function exitCookingMode() {
            document.getElementById('cookingMode').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function updateCookingStep() {
            const totalSteps = currentRecipe.instructions.length;
            
            document.getElementById('stepProgress').textContent = `Step ${currentStep + 1} of ${totalSteps}`;
            document.getElementById('stepInstruction').textContent = currentRecipe.instructions[currentStep];
            
            document.getElementById('prevStepBtn').disabled = currentStep === 0;
            
            const nextBtn = document.getElementById('nextStepBtn');
            if (currentStep === totalSteps - 1) {
                nextBtn.textContent = 'Done ✓';
            } else {
                nextBtn.textContent = 'Next →';
            }
        }
        
        function nextStep() {
            const totalSteps = currentRecipe.instructions.length;
            
            if (currentStep < totalSteps - 1) {
                currentStep++;
                updateCookingStep();
            } else {
                exitCookingMode();
            }
        }
        
        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                updateCookingStep();
            }
        }
        async function loadSavedRecipes() {
    const { data, error } = await supabase
        .from('saved_recipes')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false });
    
    if (!error && data) {
        savedRecipes = data.map(recipe => ({
            id: recipe.id,
            name: recipe.name,
            url: recipe.url,
            category: recipe.category,
            ingredients: recipe.ingredients,
            instructions: recipe.instructions,
            originalIngredients: recipe.original_ingredients
        }));
        updateSavedCount();
    }
}

async function loadShoppingList() {
    const { data, error } = await supabase
        .from('shopping_list_items')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: true });
    
    if (!error && data) {
        shoppingList = data;
        updateShoppingCount();
    }
}    
    </script>
</body>
</html>